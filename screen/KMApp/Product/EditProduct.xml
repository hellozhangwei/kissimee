
<screen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/xml-screen-2.0.xsd" default-menu-title="产品"
        default-menu-index="1">
    <parameter name="productId" required="true"/>

    <transition name="createProductIdentification">
        <service-call name="create#mantle.product.ProductIdentification"/>
        <default-response url="."/>
    </transition>
    <transition name="updateProductIdentification">
        <service-call name="update#mantle.product.ProductIdentification"/>
        <default-response url="."/>
    </transition>
    <transition name="deleteProductIdentification">
        <service-call name="delete#mantle.product.ProductIdentification"/>
        <default-response url="."/>
    </transition>

    <transition name="createProduct">
        <actions>
            <service-call name="create#mantle.product.Product" in-map="context"/>
            <service-call name="create#mantle.product.ProductIdentification" in-map="context"/>
            <message>新建成功</message>
        </actions>
        <default-response url="../EditProduct"/>
    </transition>

    <transition name="updateProduct">
        <actions>
            <service-call name="update#mantle.product.Product" in-map="context" />
            <!--<service-call name="update#mantle.product.ProductIdentification" in-map="[productId: productId,productIdTypeEnumId:'PidtEan',idValue:idValue]" out-map="context"/>-->
            <service-call name="update#mantle.product.ProductIdentification" in-map="context"/>
            <message>更新成功</message>
        </actions>
        <default-response url="."/>
    </transition>
    

    <transition name="createProductDimension">
        <service-call name="create#mantle.product.ProductDimension"/>
        <default-response url="."/>
    </transition>
    <transition name="updateProductDimension">
        <service-call name="update#mantle.product.ProductDimension"/>
        <default-response url="."/>
    </transition>
    <transition name="deleteProductDimension">
        <!--<parameter name="productIdTypeEnumId"/>-->
        <service-call name="delete#mantle.product.ProductDimension"/>
        <default-response url="."/>
    </transition>

    <actions>
        <entity-find-one entity-name="mantle.product.Product" value-field="product"/>

        <entity-find-one entity-name="cn.com.kissimee.ProductSearchView" value-field="productVar">
            <field-map field-name="productId"/>
        </entity-find-one>

        <entity-find entity-name="mantle.product.ProductIdentification" list="productIdentificationList">
            <econdition field-name="productId"/>
        </entity-find>
        
        <entity-find entity-name="mantle.product.ProductDimensionAndType" list="dimensionList">
            <econdition field-name="productId"/><order-by field-name="description"/>
        </entity-find>
        
    </actions>

    <widgets>

        <container-row>
            <row-col lg="5">
                <form-single name="EditProductForm" map="productVar" transition="updateProduct">
                    <field name="productId">
                        <default-field>
                            <hidden/>
                        </default-field>
                    </field>
                    <field name="pseudoId">
                        <default-field title="编号">
                            <text-line size="20"/>
                        </default-field>
                    </field>

                    <field name="productName">
                        <default-field title="名称">
                            <text-line size="20"/>
                        </default-field>
                    </field>
                    <field name="primaryProductCategoryId">
                        <default-field title="类别">
                            <drop-down size="20">
                                <entity-options key="${productCategoryId}" text="${categoryName}">
                                    <entity-find entity-name="mantle.product.category.ProductCategory">
                                        <econdition field-name="productCategoryId" operator="like" value="KM%"/>
                                    </entity-find>
                                </entity-options>
                            </drop-down>
                        </default-field>
                    </field>


                    <field name="productTypeEnumId">
                        <default-field title="类型">
                            <hidden/>
                           <!-- <widget-template-include
                                    location="component://webroot/template/screen/BasicWidgetTemplates.xml#enumDropDown">
                                <set field="enumTypeId" value="ProductType"/>
                            </widget-template-include>-->
                        </default-field>
                    </field>
                    <!--<field name="amountFixed">
                        <default-field title="数量">
                            <text-line size="10" format="0.######"/>
                        </default-field>
                    </field>-->
                    <!--<field name="amountUomId">
                        <default-field title="数量单位">
                            <drop-down allow-empty="true">
                                <entity-options key="${uomId}" text="${description} [${uomId}]">
                                    <entity-find entity-name="moqui.basic.Uom">
                                        <econdition field-name="uomTypeEnumId" operator="in"
                                                    value="UT_VOLUME_DRY_MEAS,UT_WEIGHT_MEASURE"/>
                                        <order-by field-name="description"/>
                                    </entity-find>
                                </entity-options>
                            </drop-down>
                        </default-field>
                    </field>-->

                    <field name="idValue">
                        <default-field title="条码">
                            <text-line size="20"/>
                        </default-field>
                    </field>

                    <field name="productIdTypeEnumId">
                        <default-field title="条码类型">
                            <hidden/>
                        </default-field>
                    </field>

                    <field name="guide">
                        <default-field title="规格">
                            <text-line size="20"/>
                        </default-field>
                    </field>

                    <field name="originGeoId">
                        <default-field title="产地">
                            <drop-down allow-empty="false" size="20">
                                <entity-options key="${geoId}" text="${geoName}">
                                    <entity-find entity-name="moqui.basic.Geo">
                                        <econdition field-name="geoId" operator="in" value="CHN,JPN,DEU"/>
                                    </entity-find>
                                </entity-options>
                            </drop-down>
                        </default-field>
                    </field>
                    <field name="uom">
                        <default-field title="单位">
                            <text-line size="20"/>
                        </default-field>
                    </field>

                    <field name="description">
                        <default-field title="描述">
                            <text-area cols="58" rows="8"/>
                        </default-field>
                    </field>
                    <field name="submitButton">
                        <default-field title="更新">
                            <submit/>
                        </default-field>
                    </field>
                </form-single>
            </row-col>
            <row-col lg="7">
                <container-box>
                    <box-header><label text="包装" type="h5"/> </box-header>
                    <box-toolbar>
                        <container-dialog id="AddProductDimension" button-text="新建包装">
                            <form-single name="AddDimensionForm" transition="createProductDimension">
                                <field name="productId"><default-field><hidden/></default-field></field>
                                <field name="dimensionTypeId"><default-field title="类型">
                                    <drop-down>
                                        <entity-options key="${dimensionTypeId}" text="${description}">
                                            <entity-find entity-name="mantle.product.ProductDimensionType">
                                                <order-by field-name="description"/>
                                            </entity-find>
                                        </entity-options>
                                    </drop-down>
                                </default-field></field>
                                <field name="value"><default-field title="数值"><text-line size="8"/></default-field></field>
                                <field name="valueUomId"><default-field title="单位">
                                    <drop-down allow-empty="true">
                                        <entity-options key="${uomId}" text="${typeDescription}: ${description}">
                                            <entity-find entity-name="moqui.basic.UomAndType">
                                                <econdition field-name="typeDescription" operator="like" value="Length%"/>
                                                <order-by field-name="typeDescription,description"/>
                                            </entity-find>
                                        </entity-options>
                                    </drop-down>
                                </default-field></field>
                                <field name="submitButton"><default-field title="添加"><submit/></default-field></field>
                            </form-single>
                        </container-dialog>
                    </box-toolbar>
                    <box-body>
                        <form-list name="DimensionForm" list="dimensionList" transition="updateProductDimension">
                            <field name="productId"><default-field><hidden/></default-field></field>
                            <field name="dimensionTypeId"><default-field><hidden/></default-field></field>
                            <field name="description"><default-field title="类型"><display/></default-field></field>
                            <field name="value"><default-field title="数值"><text-line size="8"/></default-field></field>
                            <field name="valueUomId"><default-field title="单位">
                                <drop-down allow-empty="true">
                                    <entity-options key="${uomId}" text="${typeDescription}: ${description}">
                                        <entity-find entity-name="moqui.basic.UomAndType">
                                            <econdition field-name="typeDescription" operator="like" value="Length%"/>
                                            <order-by field-name="typeDescription,description"/>
                                        </entity-find>
                                    </entity-options>
                                </drop-down>
                            </default-field></field>
                            <field name="submitButton"><default-field title="更新"><submit/></default-field></field>
                            <!--<field name="removeButton"><default-field title="">
                                <link url="deleteProductDimension" text="删除" parameter-map="[productId: productId, dimensionTypeId: dimensionTypeId]"/>
                            </default-field></field>-->
                        </form-list>
                    </box-body>
                </container-box>
                
            </row-col>
        </container-row>

    </widgets>
</screen>
